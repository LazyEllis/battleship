(()=>{"use strict";const t=class{#t;#e=0;constructor(t){this.#t=Math.max(t,1)}get length(){return this.#t}hit(){this.isSunk()||(this.#e+=1)}isSunk(){return this.#t===this.#e}};const e=class{constructor(){this.grid=Array.from({length:10},(()=>Array(10).fill(null))),this.ships=[]}placeShip(t,[e,a],s){if(!this.#a(t,[e,a],s))throw new Error("Invalid ship placement");for(let r=0;r<t.length;r+=1){const[n,o]="horizontal"===s?[e,a+r]:[e+r,a];this.grid[n][o]=t}this.ships.push(t)}#a(t,[e,a],s){for(let r=0;r<t.length;r+=1){const[t,n]="horizontal"===s?[e,a+r]:[e+r,a];if(t>=10||n>=10||this.grid[t][n]||this.#s(t,n))return!1}return!0}#s(t,e){return[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].some((([a,s])=>{const r=t+a,n=e+s;return r>=0&&r<10&&n>=0&&n<10&&this.grid[r][n]}))}receiveAttack([t,e]){const a=this.grid[t][e];a?(a.hit(),this.grid[t][e]="hit"):this.grid[t][e]="miss"}isAllSunk(){return this.ships.every((t=>t.isSunk()))}};const a=class{constructor(t,e){this.name=t,this.gameboard=e}},s=document.querySelector(".game-message"),r=document.querySelector(".rotate-btn"),n=document.querySelector(".player-grid"),o=document.querySelector(".computer-grid"),i=document.querySelectorAll(".grid"),c=document.querySelector(".game-over-modal"),l=document.querySelector(".game-over-message"),d=[4,3,3,2,2,2,1,1,1,1],h=()=>{i.forEach((t=>t.classList.toggle("enabled")))},u=t=>{const e="Player"===t.name?n:o;(t=>{for(;t.firstChild;)t.removeChild(t.firstChild)})(e),t.gameboard.grid.forEach(((a,s)=>{a.forEach(((a,r)=>{const n=document.createElement("div");n.classList.add("cell"),n.dataset.row=s,n.dataset.column=r,((t,e,a)=>{"Player"===t.name&&"object"==typeof a&&null!==a?e.classList.add("ship"):"miss"===a?e.classList.add("miss"):"hit"===a&&e.classList.add("hit")})(t,n,a),e.appendChild(n)}))}))},m=()=>{const{index:t}=s.dataset;s.dataset.length=d[+t];const{length:e}=s.dataset;s.textContent=(t=>({4:"Place your Battleship",3:"Place your Cruisers",2:"Place your Destroyers",1:"Place your Submarines"}[t]||""))(+e)},g=()=>{s.dataset.index=0,m()},p=t=>{l.textContent=t,c.showModal()},y=(t,e)=>[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].some((([a,s])=>{const r=t+a,o=e+s,i=n.querySelector(`[data-row="${r}"][data-column="${o}"]`);return i&&i.classList.contains("ship")})),f=document.querySelector(".game-message"),S=document.querySelector(".computer-grid"),L=document.querySelector(".player-grid"),b=document.querySelector(".rotate-btn"),v=document.querySelector(".restart-btn"),w=new a("Player",new e),q=new a("Computer",new e),E=()=>[Math.floor(10*Math.random()),Math.floor(10*Math.random())],k=(t,[e,a])=>"hit"===t.gameboard.grid[e][a],A=(t,[e,a])=>"miss"===t.gameboard.grid[e][a],C=t=>{let e;do{e=E()}while(k(t,e)||A(t,e));return e},P=()=>{u(w),u(q)},x=()=>{[4,3,3,2,2,2,1,1,1,1].forEach((e=>{((t,e)=>{let a=!1;for(;!a;)try{const s=E(),r=Math.random()<.5?"horizontal":"vertical";e.gameboard.placeShip(t,s,r),a=!0}catch{}})(new t(e),q)}))},z=(t,e)=>{t.gameboard.receiveAttack(e),P()},M=()=>{if(w.gameboard.isAllSunk())p("You Lose!");else{if(!q.gameboard.isAllSunk())return!1;p("You Win!")}return h(),!0};b.addEventListener("click",(()=>{r.dataset.direction="horizontal"===r.dataset.direction?"vertical":"horizontal"})),L.addEventListener("click",(e=>{if(!e.target.classList.contains("ship")&&e.target.parentNode.classList.contains("enabled")&&e.target.classList.contains("cell")){const{length:a}=f.dataset,r=new t(+a),n=[+e.target.dataset.row,+e.target.dataset.column],{direction:o}=b.dataset;try{w.gameboard.placeShip(r,n,o)}catch{return}P(),(()=>{const{index:t}=s.dataset;s.dataset.index=+t+1,m()})(),""===f.textContent&&(P(),h(),x())}})),L.addEventListener("mouseover",(t=>{if(!t.target.classList.contains("ship")&&t.target.parentNode.classList.contains("enabled")&&t.target.classList.contains("cell")){const{row:e,column:a}=t.target.dataset,{length:s}=f.dataset,{direction:r}=b.dataset;((t,e,a,s)=>{const r=[];let o=!0;for(let i=0;i<a;i+=1){const a="horizontal"===s?t:t+i,c="horizontal"===s?e+i:e,l=n.querySelector(`[data-row="${a}"][data-column="${c}"]`);if(!l||l.classList.contains("ship")||y(a,c)){o=!1;break}r.push(l)}o&&r.forEach((t=>t.classList.add("preview")))})(+e,+a,+s,r)}})),L.addEventListener("mouseout",(()=>{document.querySelectorAll(".preview").forEach((t=>t.classList.remove("preview")))})),S.addEventListener("click",(t=>{if(t.target.parentNode.classList.contains("enabled")&&t.target.classList.contains("cell")&&!t.target.classList.contains("miss")&&!t.target.classList.contains("hit")){const{row:e,column:a}=t.target.dataset,s=[parseInt(e,10),parseInt(a,10)];if(z(q,s),M())return;A(q,s)&&(()=>{let t=!0;for(;t;){const e=C(w);if(z(w,e),M())return;A(w,e)&&(t=!1)}})()}})),v.addEventListener("click",(()=>{g(),w.gameboard=new e,q.gameboard=new e,c.close(),P()})),P(),g()})();